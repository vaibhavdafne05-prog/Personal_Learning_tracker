<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Learning Tracker</title>
    <style>
        :root {
            --color-primary: #208091;
            --color-primary-hover: #1a6473;
            --color-bg: #fcfcf9;
            --color-surface: #ffffff;
            --color-text: #134252;
            --color-text-secondary: #627c81;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-success: #208091;
            --color-warning: #a84d2f;
            --color-error: #c0152f;
            --radius-base: 8px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            color: var(--color-text);
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-border);
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }

        .card h2 {
            margin: 0 0 16px 0;
            font-size: 18px;
            color: var(--color-text);
        }

        .form-group {
            margin-bottom: 14px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 13px;
            color: var(--color-text);
        }

        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            color: var(--color-text);
            background: white;
            transition: border-color 150ms;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(32, 128, 145, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        button {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 150ms;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: rgba(94, 82, 64, 0.12);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(94, 82, 64, 0.2);
        }

        .btn-danger {
            background: transparent;
            color: var(--color-error);
            border: 1px solid var(--color-error);
        }

        .btn-danger:hover {
            background: rgba(192, 21, 47, 0.08);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(32, 128, 145, 0.08);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: 4px;
        }

        .sessions-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .session-item {
            background: rgba(32, 128, 145, 0.04);
            border-left: 3px solid var(--color-primary);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .session-content {
            flex: 1;
        }

        .session-date {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .session-topic {
            color: var(--color-text-secondary);
            margin-bottom: 3px;
        }

        .session-hours {
            display: inline-block;
            background: var(--color-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-right: 8px;
        }

        .session-delete {
            background: none;
            border: none;
            color: var(--color-error);
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .session-delete:hover {
            background: rgba(192, 21, 47, 0.1);
            border-radius: 3px;
        }

        .ai-summary {
            background: rgba(245, 158, 11, 0.08);
            border-left: 3px solid #a84d2f;
            padding: 12px;
            margin: 12px 0;
            border-radius: 4px;
            font-size: 13px;
            color: var(--color-text);
            line-height: 1.6;
        }

        .empty-state {
            text-align: center;
            color: var(--color-text-secondary);
            padding: 20px;
            font-size: 13px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(94, 82, 64, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-success);
            border-radius: 4px;
            transition: width 300ms;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .alert-success {
            background: rgba(32, 128, 145, 0.1);
            color: var(--color-success);
            border: 1px solid rgba(32, 128, 145, 0.2);
        }

        .alert-error {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
            border: 1px solid rgba(192, 21, 47, 0.2);
        }

        .hidden {
            display: none;
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 12px;
        }

        .topic-tag {
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 12px;
            background: rgba(32, 128, 145, 0.12);
            color: var(--color-primary);
            text-align: center;
            cursor: pointer;
            transition: all 150ms;
            border: none;
        }

        .topic-tag:hover {
            background: rgba(32, 128, 145, 0.2);
        }

        .topic-tag.selected {
            background: var(--color-primary);
            color: white;
        }

        .export-import {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .export-import button {
            flex: 1;
            padding: 8px 12px;
            font-size: 12px;
        }

        small {
            color: var(--color-text-secondary);
            display: block;
            margin-top: 4px;
        }

        .n8n-config {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            font-size: 12px;
        }

        .n8n-config input {
            font-size: 12px;
            padding: 8px;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: none;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
        }

        .modal-active .modal,
        .modal-active .modal-backdrop {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(32, 128, 145, 0.3);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö AI Learning Tracker</h1>
            <p class="subtitle">Track embedded systems & interview prep with AI insights</p>
        </header>

        <div id="alert" class="hidden"></div>

        <div class="layout">
            <!-- Log Session Card -->
            <div class="card">
                <h2>Log Learning Session</h2>
                
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="sessionDate">
                </div>

                <div class="form-group">
                    <label>Quick Topics</label>
                    <div class="topics-grid" id="topicsGrid"></div>
                </div>

                <div class="form-group">
                    <label>Custom Topic</label>
                    <input type="text" id="customTopic" placeholder="e.g., AUTOSAR, CAN bus, C++ templates">
                </div>

                <div class="form-group">
                    <label>Hours Studied</label>
                    <input type="number" id="sessionHours" min="0.5" step="0.5" value="1">
                </div>

                <div class="form-group">
                    <label>Notes / What You Learned</label>
                    <textarea id="sessionNotes" placeholder="Describe what you studied today..."></textarea>
                </div>

                <div class="n8n-config">
                    <label style="margin-bottom: 8px;">üîó n8n Webhook URL (Optional)</label>
                    <input type="text" id="webhookUrl" placeholder="https://your-n8n-instance.com/webhook/learning-log">
                    <small>Add your n8n webhook for AI analysis, mock questions & email digests</small>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="logSession()">Log Session</button>
                    <button class="btn-secondary" onclick="clearForm()">Clear</button>
                </div>
            </div>

            <!-- Stats & Summary Card -->
            <div class="card">
                <h2>Learning Progress</h2>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="totalHours">0</div>
                        <div class="stat-label">Total Hours</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="sessionCount">0</div>
                        <div class="stat-label">Sessions</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="topicCount">0</div>
                        <div class="stat-label">Topics</div>
                    </div>
                </div>

                <div>
                    <label>Weekly Goal: 20 hours</label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <small>
                        <span id="weeklyHours">0</span> / 20 hours this week
                    </small>
                </div>

                <h3 style="margin-top: 20px; font-size: 16px;">AI Recommendations</h3>
                <div id="aiRecommendations" style="font-size: 13px; color: var(--color-text-secondary); line-height: 1.6;">
                    <p style="margin: 0;">Log your first session to get personalized recommendations.</p>
                </div>

                <div class="export-import">
                    <button class="btn-secondary" onclick="exportData()">üì• Export</button>
                    <button class="btn-secondary" onclick="importData()">üì§ Import</button>
                </div>
            </div>
        </div>

        <!-- Recent Sessions -->
        <div class="card">
            <h2>üìã Recent Learning Sessions</h2>
            <div class="sessions-list" id="sessionsList">
                <div class="empty-state">No sessions logged yet. Start by logging your first session!</div>
            </div>
        </div>
    </div>

    <!-- Modal for Mock Questions -->
    <div class="modal-backdrop" id="modalBackdrop" onclick="closeMockQuestionsModal()"></div>
    <div class="modal" id="mockQuestionsModal">
        <h2 style="margin-top: 0; color: #134252;">üéØ Mock Interview Questions</h2>
        <div id="modalContent" style="color: #627c81; line-height: 1.8;"></div>
        <button onclick="closeMockQuestionsModal()" style="
            width: 100%;
            padding: 12px;
            background: #208091;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 20px;
        ">Close</button>
    </div>

    <script>
        const TOPICS = [
            'C++', 'Embedded Systems', 'AUTOSAR', 'CAN Bus',
            'Linux Kernel', 'Cybersecurity', 'Interview Prep', 'Trading Bot'
        ];

        // Initialize
        function init() {
            setToday();
            renderTopicTags();
            loadSessions();
            updateStats();
            loadWebhookUrl();
        }

        function setToday() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sessionDate').value = today;
        }

        function loadWebhookUrl() {
            const saved = localStorage.getItem('n8nWebhookUrl');
            if (saved) {
                document.getElementById('webhookUrl').value = saved;
            }
        }

        function renderTopicTags() {
            const grid = document.getElementById('topicsGrid');
            TOPICS.forEach(topic => {
                const tag = document.createElement('button');
                tag.className = 'topic-tag';
                tag.textContent = topic;
                tag.type = 'button';
                tag.onclick = () => {
                    document.getElementById('customTopic').value = topic;
                    document.querySelectorAll('.topic-tag').forEach(t => t.classList.remove('selected'));
                    tag.classList.add('selected');
                };
                grid.appendChild(tag);
            });
        }

        function logSession() {
            const date = document.getElementById('sessionDate').value;
            const topic = document.getElementById('customTopic').value || 'General';
            const hours = parseFloat(document.getElementById('sessionHours').value);
            const notes = document.getElementById('sessionNotes').value;
            const webhookUrl = document.getElementById('webhookUrl').value;

            if (!date || !hours || !notes) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            // Save webhook URL
            if (webhookUrl) {
                localStorage.setItem('n8nWebhookUrl', webhookUrl);
            }

            const session = { date, topic, hours, notes, id: Date.now() };
            const sessions = getSessions();
            sessions.unshift(session);
            localStorage.setItem('learningSessions', JSON.stringify(sessions));

            showAlert(`Session logged: ${hours}h on ${topic}`, 'success');

            // Send to n8n if webhook configured
            if (webhookUrl) {
                sendToN8N(session, webhookUrl);
            }

            clearForm();
            loadSessions();
            updateStats();
            generateAIRecommendations();
        }

        function sendToN8N(session, webhookUrl) {
            showAlert('‚è≥ Analyzing with AI... <span class="loading-spinner"></span>', 'success');

            fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    date: session.date,
                    topic: session.topic,
                    hours: session.hours,
                    notes: session.notes,
                    email: prompt('Enter your email for analysis digest:', 'user@example.com') || 'user@example.com'
                })
            })
            .then(r => r.json())
            .then(data => {
                console.log('n8n Response:', data);
                showAlert('‚ú® AI analysis complete! Check your email for the digest.', 'success');
                if (data.mockQuestions && Array.isArray(data.mockQuestions)) {
                    displayMockQuestions(data.mockQuestions);
                }
            })
            .catch(err => {
                console.error('n8n Error:', err);
                showAlert('Could not reach n8n. Check webhook URL.', 'error');
            });
        }

        function displayMockQuestions(questions) {
            const modalContent = document.getElementById('modalContent');
            if (!questions || questions.length === 0) {
                modalContent.innerHTML = '<p>No questions generated. Try again with more detailed notes.</p>';
            } else {
                modalContent.innerHTML = questions.map((q, i) => `
                    <div style="margin-bottom: 20px; padding: 12px; background: rgba(32, 128, 145, 0.04); border-radius: 6px;">
                        <strong>Q${i+1}: ${q.question || q}</strong>
                        ${q.hint ? `<p style="margin: 8px 0 0 0; font-size: 13px; color: #208091;">üí° <em>${q.hint}</em></p>` : ''}
                    </div>
                `).join('');
            }
            document.body.classList.add('modal-active');
        }

        function closeMockQuestionsModal() {
            document.body.classList.remove('modal-active');
        }

        function getSessions() {
            const data = localStorage.getItem('learningSessions');
            return data ? JSON.parse(data) : [];
        }

        function loadSessions() {
            const sessions = getSessions();
            const list = document.getElementById('sessionsList');
            
            if (sessions.length === 0) {
                list.innerHTML = '<div class="empty-state">No sessions logged yet. Start tracking your learning!</div>';
                return;
            }

            list.innerHTML = sessions.map(s => `
                <div class="session-item">
                    <div class="session-content">
                        <div class="session-date">${new Date(s.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</div>
                        <div class="session-topic"><strong>${s.topic}</strong></div>
                        <div>
                            <span class="session-hours">${s.hours}h</span>
                            <span style="color: var(--color-text-secondary);">${s.notes.substring(0, 80)}${s.notes.length > 80 ? '...' : ''}</span>
                        </div>
                    </div>
                    <button class="session-delete" onclick="deleteSession(${s.id})" title="Delete">‚úï</button>
                </div>
            `).join('');
        }

        function deleteSession(id) {
            const sessions = getSessions();
            const filtered = sessions.filter(s => s.id !== id);
            localStorage.setItem('learningSessions', JSON.stringify(filtered));
            loadSessions();
            updateStats();
            generateAIRecommendations();
            showAlert('Session deleted', 'success');
        }

        function updateStats() {
            const sessions = getSessions();
            const totalHours = sessions.reduce((sum, s) => sum + s.hours, 0);
            const uniqueTopics = new Set(sessions.map(s => s.topic)).size;
            
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const weeklyHours = sessions.filter(s => new Date(s.date) >= weekAgo).reduce((sum, s) => sum + s.hours, 0);

            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            document.getElementById('sessionCount').textContent = sessions.length;
            document.getElementById('topicCount').textContent = uniqueTopics;
            document.getElementById('weeklyHours').textContent = weeklyHours.toFixed(1);
            document.getElementById('progressFill').style.width = Math.min((weeklyHours / 20) * 100, 100) + '%';
        }

        function generateAIRecommendations() {
            const sessions = getSessions();
            if (sessions.length === 0) return;

            const topics = [...new Set(sessions.slice(0, 5).map(s => s.topic))].join(', ');
            const recentHours = sessions.slice(0, 5).reduce((sum, s) => sum + s.hours, 0);

            const recommendations = [
                `üìà Great progress! You've logged ${recentHours.toFixed(1)}h in recent sessions.`,
                `üéØ Focus areas: ${topics}. Consistency builds mastery for senior interviews.`,
                `üí° Next: Dive deeper into AUTOSAR & ISO 26262 (functional safety).`,
                `‚ö° Pro tip: Combine C++ coding with embedded systems theory daily.`,
                `üîÑ Review: Schedule weekly practice on LeetCode hard mode for interviews.`
            ];

            document.getElementById('aiRecommendations').innerHTML = 
                recommendations.map(r => `<p style="margin: 6px 0; color: var(--color-text);">‚Üí ${r}</p>`).join('');
        }

        function clearForm() {
            document.getElementById('customTopic').value = '';
            document.getElementById('sessionHours').value = '1';
            document.getElementById('sessionNotes').value = '';
            document.querySelectorAll('.topic-tag').forEach(tag => tag.classList.remove('selected'));
        }

        function exportData() {
            const sessions = getSessions();
            const json = JSON.stringify(sessions, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `learning_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showAlert('Data exported successfully', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (!Array.isArray(data)) throw new Error('Invalid format');
                        localStorage.setItem('learningSessions', JSON.stringify(data));
                        loadSessions();
                        updateStats();
                        generateAIRecommendations();
                        showAlert(`Imported ${data.length} sessions`, 'success');
                    } catch (err) {
                        showAlert('Import failed: ' + err.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            alert.classList.remove('hidden');
            setTimeout(() => alert.classList.add('hidden'), 4000);
        }

        // Init on load
        init();
    </script>
</body>
</html>
